# Lock Files

> **âœ… Status: Implemented (v0.1.0)**
> Lock file functionality is fully implemented. This document describes the current implementation.

Reproducible builds with cryptographic dependency tracking.

## Quick Start

```yaml
# toolchainkit.lock (auto-generated)
version: "1.0"
platform: linux-x64-glibc
generated_at: "2025-11-24T10:30:00Z"

toolchain:
  id: llvm-18.1.8-linux-x64
  type: llvm
  version: 18.1.8
  sha256: e2e96558...
  download_url: https://github.com/llvm/...

build_tools:
  cmake:
    version: 3.28.1
    sha256: abc123...

packages:
  fmt:
    version: 10.2.0
    sha256: def456...
```

```python
from toolchainkit.config.lockfile import LockFileManager

lock_mgr = LockFileManager(project_root)

# Generate lock file
lock_mgr.generate_lockfile(config, toolchain_dir)

# Verify installation matches lock file
is_valid = lock_mgr.verify_lockfile()
if not is_valid:
    print("Lock file mismatch - dependencies changed")
```

## API

```python
class LockFileManager:
    def generate_lockfile(self, config: Config, toolchain_dir: Path) -> None
    def verify_lockfile(self) -> bool
    def load_lockfile(self) -> LockFile
    def compute_diff(self, old_lock: LockFile, new_lock: LockFile) -> Dict
```

## Lock File Structure

```yaml
version: "1.0"
platform: string              # Platform string
generated_at: string          # ISO 8601 timestamp

toolchain:
  id: string
  type: llvm|gcc|msvc
  version: string
  sha256: string              # Toolchain archive hash
  download_url: string

build_tools:
  cmake:
    version: string
    sha256: string

packages:                     # From Conan/vcpkg
  <name>:
    version: string
    sha256: string
```

## Features

- **Reproducibility**: Pin exact versions with hashes
- **Verification**: Check if installation matches lock file
- **Diff**: Compare lock files to see what changed
- **Platform-specific**: Separate locks per platform
- **Supply chain security**: Cryptographic hashes for all deps

## Example Workflow

```bash
# 1. Initial setup - generates lock file
tkgen init

# 2. Commit lock file to version control
git add toolchainkit.lock
git commit -m "Lock dependencies"

# 3. On CI or other machines - verify and install
tkgen configure  # Installs exact versions from lock
```

## Integration

- Generated by: `tkgen init`, `tkgen configure`
- Used by: CI/CD systems, reproducible builds
- Verified by: `tkgen doctor`
